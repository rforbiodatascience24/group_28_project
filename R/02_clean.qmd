---
title: "02_clean.qmd"
format: html
editor: visual
---

```{r}
#| output: false
library("here")
library("tidyverse")
```

```{r}
loaded_data <- read_csv(file = here("data/01_dat_load.csv.gz"), 
                na = "NA",  col_types = cols(
  days_to_death.demographic = col_double()
))
```


## Tidying the data

### Renaming the columns

```{r}

clean_data <- loaded_data |> 
  rename_with(~ str_replace(., "\\..*", "")) |> 
  rename("ensembl_id" = "Ensembl_ID", 
         "cancer_stage" = "ajcc_pathologic_stage")

```

### Tidying treatment and therapy

```{r}

clean_data <- clean_data |> 
  mutate(treatment_or_therapy = str_remove_all(treatment_or_therapy, 
                                               pattern = "[\\[\\]\\']")) |> 
  separate_wider_delim(treatment_or_therapy,
                       delim = ", ",
                       names = c("treatment", "therapy"))
```

### 

```{r}
write_csv(x = clean_data, 
          file = here("data/02_dat_clean.csv.gz"))
```
